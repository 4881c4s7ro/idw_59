<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Cl√≠nica Salud y Vida - Turnos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body.dark-mode {
      background-color: #121212 !important;
      color: #e0e0e0 !important;
    }
    body.dark-mode .bg-light,
    body.dark-mode .bg-white {
      background-color: #1e1e1e !important;
    }
    body.dark-mode .navbar-light {
      background-color: #1e1e1e !important;
    }
    body.dark-mode .table {
      color: #e0e0e0;
    }
    body.dark-mode .table thead {
      background-color: #2c2c2c;
    }
    body.dark-mode .table tbody tr:nth-child(even) {
      background-color: #292929;
    }
    body.dark-mode .navbar-brand,
    body.dark-mode .nav-link {
      color: #bb86fc !important;
    }
    body.dark-mode .nav-link.active {
      color: #3700b3 !important;
      font-weight: bold;
    }
    #darkModeToggle {
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      font-size: 1.25rem;
    }
  </style>
</head>

<body class="bg-light">
  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand text-primary fw-bold" href="../index.html">Cl√≠nica Salud y Vida</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item"><a class="nav-link" href="../index.html">Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="../institucional/institucional.html">Institucional</a></li>
          <li class="nav-item"><a class="nav-link" href="../contacto/contacto.html">Contacto</a></li>
          <li class="nav-item"><a class="nav-link active" href="#">Turnos</a></li>
          <li class="nav-item ms-3">
            <button id="darkModeToggle" aria-label="Toggle dark mode" title="Modo oscuro">üåô</button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <main class="container my-5">
    <section>
      <h2 class="text-primary mb-3">Gesti√≥n de Turnos</h2>
      <p class="mb-4">Aqu√≠ puedes registrar, editar o eliminar los turnos programados.</p>

      <!-- FORMULARIO -->
      <form id="formTurno" class="row g-3 mb-2">
        <input type="hidden" id="turnoId" />
        <div class="col-md-3">
          <label class="form-label">Doctor</label>
          <input type="text" id="doctor" class="form-control" required />
        </div>
        <div class="col-md-3">
          <label class="form-label">Paciente</label>
          <input type="text" id="paciente" class="form-control" required />
        </div>
        <div class="col-md-3">
          <label class="form-label">D√≠a</label>
          <select id="dia" class="form-select" required>
            <option value="">Seleccione un d√≠a</option>
            <option>Lunes</option>
            <option>Martes</option>
            <option>Mi√©rcoles</option>
            <option>Jueves</option>
            <option>Viernes</option>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label">Hora</label>
          <input type="time" id="hora" class="form-control" required />
        </div>
        <div class="col-md-1 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">Guardar</button>
        </div>
      </form>

      <!-- TABLA -->
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Doctor</th>
              <th>Paciente</th>
              <th>D√≠a</th>
              <th>Hora</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="tablaTurnos">
            <!-- Cargado din√°micamente -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="bg-white text-center py-3 shadow-sm mt-5">
    <p class="mb-0">&copy; 2025 Cl√≠nica Salud y Vida - Todos los derechos reservados</p>
  </footer>

  <script src="../assets/js/bootstrap.bundle.min.js"></script>

  <!-- Dark mode -->
  <script>
    const toggleButton = document.getElementById('darkModeToggle');
    const body = document.body;

    if(localStorage.getItem('darkMode')==='enabled'){
      body.classList.add('dark-mode');
      toggleButton.textContent='‚òÄÔ∏è';
    }

    toggleButton.addEventListener('click',()=>{
      body.classList.toggle('dark-mode');
      if(body.classList.contains('dark-mode')){
        toggleButton.textContent='‚òÄÔ∏è';
        localStorage.setItem('darkMode','enabled');
      } else {
        toggleButton.textContent='üåô';
        localStorage.setItem('darkMode','disabled');
      }
    });
  </script>

  <!-- JS Turnos -->
  <script type="module">
    const usuarioLogueado = localStorage.getItem("usuarioLogueado") === "true";

    const inicializarStorageTurnos = () => {
      if (!localStorage.getItem("turnos")) {
        const turnos = [
          { id: 1, doctor: "Dr. Ricardo Fern√°ndez", paciente: "Juan Mart√≠nez", dia: "Lunes", hora: "09:00" },
          { id: 2, doctor: "Dra. Ana P√©rez", paciente: "Mar√≠a L√≥pez", dia: "Lunes", hora: "10:00" },
          { id: 3, doctor: "Dr. Juan L√≥pez", paciente: "Carlos G√≥mez", dia: "Martes", hora: "11:00" },
          { id: 4, doctor: "Dra. Lautaro G√≥mez", paciente: "Luc√≠a Fern√°ndez", dia: "Mi√©rcoles", hora: "14:00" }
        ];
        localStorage.setItem("turnos", JSON.stringify(turnos));
      }
    };

    const obtenerTurnos = () => JSON.parse(localStorage.getItem("turnos")) || [];
    const guardarTurnos = lista => localStorage.setItem("turnos", JSON.stringify(lista));

    const renderizarTabla = () => {
      const tabla = document.getElementById("tablaTurnos");
      if(!tabla) return;
      const turnos = obtenerTurnos();
      if(turnos.length === 0){
        tabla.innerHTML = `<tr><td colspan="6" class="text-center text-muted">No hay turnos disponibles</td></tr>`;
        return;
      }

      tabla.innerHTML = turnos.map(t=>`
        <tr>
          <td>${t.id}</td>
          <td>${t.doctor}</td>
          <td>${t.paciente}</td>
          <td>${t.dia}</td>
          <td>${t.hora}</td>
          <td>
            ${usuarioLogueado ? `
              <button class="btn btn-warning btn-sm" onclick="editarTurno(${t.id})">Editar</button>
              <button class="btn btn-danger btn-sm" onclick="eliminarTurno(${t.id})">Eliminar</button>
            ` : `<span class="text-muted">Login requerido</span>`}
          </td>
        </tr>
      `).join('');
    };

    if(usuarioLogueado){
      window.crearTurno = (event) => {
        event.preventDefault();
        const doctor = document.getElementById("doctor").value.trim();
        const paciente = document.getElementById("paciente").value.trim();
        const dia = document.getElementById("dia").value;
        const hora = document.getElementById("hora").value;
        if(!doctor || !paciente || !dia || !hora) return alert("Complete todos los campos");

        const turnos = obtenerTurnos();
        const nuevoId = turnos.length>0 ? Math.max(...turnos.map(t=>t.id))+1 : 1;
        turnos.push({id:nuevoId,doctor,paciente,dia,hora});
        guardarTurnos(turnos);
        renderizarTabla();
        event.target.reset();
        document.getElementById("turnoId").value="";
      };

      window.editarTurno = (id) => {
        const turnos = obtenerTurnos();
        const t = turnos.find(t=>t.id===id);
        if(!t) return alert("Turno no encontrado");
        document.getElementById("doctor").value = t.doctor;
        document.getElementById("paciente").value = t.paciente;
        document.getElementById("dia").value = t.dia;
        document.getElementById("hora").value = t.hora;
        document.getElementById("turnoId").value = t.id;
      };

      window.actualizarTurno = (event) => {
        event.preventDefault();
        const id = parseInt(document.getElementById("turnoId").value);
        if(!id) return window.crearTurno(event);

        const turnos = obtenerTurnos();
        const index = turnos.findIndex(t=>t.id===id);
        if(index===-1) return alert("Turno no encontrado");

        turnos[index]={ 
          id,
          doctor: document.getElementById("doctor").value.trim(),
          paciente: document.getElementById("paciente").value.trim(),
          dia: document.getElementById("dia").value,
          hora: document.getElementById("hora").value
        };
        guardarTurnos(turnos);
        renderizarTabla();
        event.target.reset();
        document.getElementById("turnoId").value="";
      };

      window.eliminarTurno = (id) => {
        if(!confirm("Desea eliminar este turno?")) return;
        const turnos = obtenerTurnos().filter(t=>t.id!==id);
        guardarTurnos(turnos);
        renderizarTabla();
      };
    } else {
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("formTurno");
        form.querySelectorAll("input, select, button").forEach(el => el.disabled = true);
        form.querySelector("button[type='submit']").textContent = "Debe iniciar sesi√≥n para modificar";
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      inicializarStorageTurnos();
      renderizarTabla();
      if(usuarioLogueado){
        document.getElementById("formTurno").addEventListener("submit", actualizarTurno);
      }
    });
  </script>

  <!-- Navbar din√°mico -->
  <script type="module" src="../assets/js/navbar.js"></script>
</body>
</html>
